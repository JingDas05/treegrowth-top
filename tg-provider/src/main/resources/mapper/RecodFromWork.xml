<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="">

    <resultMap id="ajBasicInfo" type="com.thunisoft.sfal.cases.service.bo.AjBasicInfo">
        <!-- 案名 -->
        <id property="am" column="C_AM" jdbcType="VARCHAR"/>
        <!-- 案号 -->
        <result property="ah" column="C_AH" jdbcType="VARCHAR"/>
        <!-- 案件类别 -->
        <result property="ajlb" column="C_AJLB" jdbcType="VARCHAR"/>
        <!-- 案由 -->
        <result property="ay" column="C_AY" jdbcType="VARCHAR"/>
        <!-- 审理法院 -->
        <result property="slfy" column="C_SLFY" jdbcType="VARCHAR"/>
        <!-- 审理程序 -->
        <result property="slcx" column="C_SLCX" jdbcType="VARCHAR"/>
        <!-- 裁判日期 -->
        <result property="cprq" column="D_CPRQ" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- 案例详情 -->
    <resultMap id="caseDetail" type="com.thunisoft.sfal.cases.service.bo.CaseDetail">
        <!-- 案例ID -->
        <id property="id" column="C_ID" jdbcType="CHAR"/>
        <result property="name" column="C_NAME" jdbcType="VARCHAR"/>
        <!-- 提起时间 -->
        <result property="tqsj" column="D_TQSJ" jdbcType="TIMESTAMP"/>
        <!-- 推荐人ID -->
        <result property="userId" column="C_USER_ID" jdbcType="CHAR"/>
        <!-- 案例来源，指导性案例，公报案例， 公布案例， 审判参考案例， 众筹案例，大数据 -->
        <result property="ally" column="N_ALLY" jdbcType="INTEGER"/>
        <!-- 推荐理由 -->
        <result property="tjly" column="C_TJLY" jdbcType="VARCHAR"/>
        <!-- 关键词 -->
        <result property="gjc" column="C_GJC" jdbcType="VARCHAR"/>
        <!--争议焦点 -->
        <result property="zyjd" column="C_ZYJD" jdbcType="VARCHAR"/>
        <!-- 裁判要点 -->
        <result property="cpyd" column="LC_CPYD" jdbcType="VARCHAR"/>
        <!-- 案例涉及法条，法条ID   法律名称  法律编号，拼串 -->
        <result property="alsjft" column="C_ALSJFT" jdbcType="VARCHAR"/>
        <!-- 相关文书ID -->
        <result property="xgwsId" column="C_XGWS_ID" jdbcType="VARCHAR"/>
        <!-- 案例状态，0:草稿 1.提交审核 2:审核不通过 3.评选  9：达到入库标准，未入库10:入库 -->
        <result property="alzt" column="N_ALZT" jdbcType="INTEGER"/>
        <!-- 类型，0：法信 1：推选 导入案例时，便于前台判断） -->
        <result property="type" column="N_TYPE" jdbcType="INTEGER"/>
        <!-- 摆渡标志位，所有保存和修改都把标志位至1，不使用更新时间做标记 -->
        <result property="mark" column="N_MARK" jdbcType="INTEGER"/>
        <!-- 支持数 -->
        <result property="ups" column="N_UPS" jdbcType="INTEGER"/>
        <!-- 反对数 -->
        <result property="downs" column="N_DOWNS" jdbcType="INTEGER"/>
        <!-- 浏览次数 -->
        <result property="views" column="N_VIEWS" jdbcType="INTEGER"/>
        <!-- 关注数 -->
        <result property="follows" column="N_FOLLOWS" jdbcType="INTEGER"/>
        <!-- 观点数 -->
        <result property="gdCount" column="N_GD_COUNT" jdbcType="INTEGER"/>
        <association property="ajBasicInfo" resultMap="ajBasicInfo"/>
    </resultMap>

    <!-- 首页案例 -->
    <resultMap id="indexCase" type="com.thunisoft.sfal.cases.service.bo.IndexCase">
        <!-- 案例ID -->
        <id property="id" column="C_ID" jdbcType="CHAR"/>
        <result property="name" column="C_NAME" jdbcType="VARCHAR"/>
        <!-- 提起时间 -->
        <result property="tqsj" column="D_TQSJ" jdbcType="TIMESTAMP"/>
        <!-- 推荐人ID -->
        <result property="userId" column="C_USER_ID" jdbcType="CHAR"/>
        <!-- 关键词 -->
        <result property="gjc" column="C_GJC" jdbcType="VARCHAR"/>
        <!-- 裁判要点 -->
        <result property="cpyd" column="LC_CPYD" jdbcType="VARCHAR"/>
        <!-- 支持数 -->
        <result property="ups" column="N_UPS" jdbcType="INTEGER"/>
        <!-- 浏览次数 -->
        <result property="views" column="N_VIEWS" jdbcType="INTEGER"/>
        <!-- 收藏数 -->
        <result property="collectCount" column="N_COLLECT_COUNT" jdbcType="INTEGER"/>
        <!-- 观点数 -->
        <result property="comments" column="N_COMMENTS" jdbcType="INTEGER"/>
        <!-- 观点数 -->
        <result property="shares" column="N_SHARES" jdbcType="INTEGER"/>
    </resultMap>

    <!--List<IndexCase> getIndexCaseOrderByHot(@Param("bmfIds") List<String> bmfIds);-->
    <select id="getIndexCaseOrderByHot" parameterType="java.lang.String" resultMap="indexCase">
        select
        al.C_ID,
        al.C_NAME,
        al.LC_CPYD,
        al.C_GJC,
        al.C_USER_ID,
        al.D_TQSJ,
        al.C_BMF as C_BMF,
        al_ext.N_UPS as N_UPS,
        al_ext.N_VIEWS as N_VIEWS,
        al_ext.N_COLLECT_COUNT as N_COLLECT_COUNT,
        al_ext.N_SHARES as N_SHARES,
        al_ext.N_COMMENTS as N_COMMENTS
        from
        db_case.T_CASE as al
        left JOIN db_case.T_CASE_EXT as al_ext on al.C_ID = al_ext.C_ID
        <where>
            <if test="bmfIds[0] != 'all'">
                C_BMF in
                <foreach item="item" index="index" collection="bmfIds"
                         open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
        </where>
        order by N_UPS*2 + N_VIEWS + 2*N_SHARES + 2*N_COLLECT_COUNT + 3*N_COMMENTS desc
    </select>

    <!--void addCaseDsrs(@Param("dsrs") List<CaseDsr> dsrs);-->
    <insert id="addCaseDsrs" parameterType="com.thunisoft.sfal.model.cases.CaseDsr">
        insert into db_case.T_CASE_DSR
        (C_ID, C_AJ_ID, C_NAME, C_SSDW, N_MARK)
        values
        <foreach collection="dsrs" item="item" index="index" separator=",">
            (#{item.id},#{item.ajId},#{item.name},#{item.ssdw},#{item.mark})
        </foreach>
    </insert>


</mapper>